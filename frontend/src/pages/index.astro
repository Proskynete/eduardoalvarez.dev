---
import { useSanityClient } from "astro-sanity";
import type { Post, SanityCategory } from "../interfaces";
import Layout from "../layouts/base.astro";

const posts: Post[] = await useSanityClient().fetch(`*[_type == "post"]`);
const categories: SanityCategory[] = await useSanityClient().fetch(
  `*[_type == "category"]`
);
---

<Layout>
  <h1>Astro</h1>

  {
    posts.map(
      ({
        title,
        description,
        publishedAt,
        categories: postCategories,
        slug: { current },
      }) => (
        <article>
          <header>
            <a href={`articulos/${current}`}>{title}</a>
          </header>

          <div>{description}</div>
          <time datetime={publishedAt}>
            {new Date(publishedAt).toLocaleDateString()}
          </time>
          <ul>
            {postCategories.map((category) => (
              <li>
                {categories.find(({ _id }) => _id === category._ref)?.title}
              </li>
            ))}
          </ul>
        </article>
      )
    )
  }
</Layout>
