---
import "../../assets/styles/article.css";

import Giscus from "@giscus/react";
import Layout from "../base/index.astro";
import Head from "./components/head.astro";
import Aside from "./components/aside.astro";
import { articlesSort } from "../../utils/articles";
import { calculateReadingTime } from "../../utils/reading-time";
import type { Props as BaseHeadProps } from "../base/components/head.astro";
import type { Article } from "../../interfaces";

type Frontmatter = Article;
const { content } = Astro.props;

const timeToRead = calculateReadingTime(await Astro.slots.render("default"));

const articles = await Astro.glob<Frontmatter>("../../pages/articulos/*.mdx");
const articleFound = articles
  .sort(articlesSort)
  .findIndex((article) => article.frontmatter.slug === content.slug);

const previousArticle = articles[articleFound + 1];
const nextArticle = articles[articleFound - 1];

const seo: BaseHeadProps = {
  title: content.title,
  description: content.description,
  image: content.seo_image,
  slug: `/articulos/${content.slug}`,
};
---

<Layout seo={seo}>
  <article>
    <div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700">
      <Head content={content} />

      <div
        class="grid flex-row-reverse grid-rows-[auto_1fr] pt-10 divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"
      >
        <Aside
          content={content}
          timeToRead={timeToRead}
          previousArticle={previousArticle}
          nextArticle={nextArticle}
        />

        <div
          class="divide-y divide-gray-200 dark:divide-gray-700 col-span-3 xl:pb-0 xl:col-start-2 xl:row-span-2 pt-4 xl:pt-0"
        >
          <div
            id="article-body"
            class="prose max-w-none pb-8 dark:prose-invert"
          >
            <slot />
          </div>

          <Giscus
            id="comments"
            repo="Proskynete/website"
            repoId="R_kgDOJ_yh4w"
            category="Announcements"
            categoryId="DIC_kwDOJ_yh484Cb_lo"
            mapping="specific"
            term={content.slug}
            strict="0"
            reactionsEnabled="1"
            emitMetadata="0"
            inputPosition="top"
            theme="preferred_color_scheme"
            lang="es"
            loading="lazy"
          />
        </div>
      </div>
    </div>
  </article>
</Layout>
